<!doctype html> 
<html> 
<head> 
  <meta charset="utf-8">
  <title>Screen Perfect Daimio Prototype</title>
<!--  <script type="text/javascript" src="http://sherpa.local/~dann/screenperfect/daimio_composite.js"></script> -->
  <script type="text/javascript" src="http://sherpa.local/~dann/daimio/get.php?file=daimio"></script>
</head>
<body>
  
  <div id="main"></div>

  <script id="control" type="text/daml" class="spaceseeds">
    outer
      
      $videos {}
      $active-video {}
      
      // NETWORK
      @game-data  socket-in  game-data
      @get-data   socket-out get-data
      @set-active socket-out
      @get-active socket-in
      
      @init from-js
      @init -> { __ | tap } -> @get-data
      
      changed {__}
      set-active {__ | >id | $videos.{_id} | >$active-video}
      @game-data -> { __.videos | >$videos | list keys | __.#1} -> set-active -> changed
      
      // DISPLAY 
      show-active 
        <img id="clicky" src="{$active-video.urls.client_thumb}">
      
      @set-main dom-set-html main
      changed -> show-active -> @set-main
      
      // CLICKS
      @clicky dom-on-click
      @clicky -> {$active-video.spots.#1.link} -> @set-active
      
      @get-active -> set-active
      
  </script>


  <script src="/socket.io/socket.io.js"></script>
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
      
      // TODO: client vs control (read url)
      // TODO: multiple spots (clickable divs)
      // TODO: show videos
      // TODO: editable data
      // TODO: hide socket connection
      
      socket = io.connect('http://sherpa.local:8888/') // published for demo (icky)
      
      var seedlikes = Array.prototype.slice.call(
                        document.getElementsByClassName('spaceseeds')
                      ).map(function(node) {
                        return node.text
                      }).join("\n")
      
      var outerseed = D.make_some_space(seedlikes)
      OuterSpace = new D.Space(outerseed) // published for debug
      
      // activate init port
      var data = {}
      D.send_value_to_js_port(outerseed, 'init', data)      
    })
  </script>

</body>
</html>